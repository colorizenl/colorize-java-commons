apply plugin: "java"
apply plugin: "jacoco"

group = "nl.colorize"
version = "2019.2.4"
sourceCompatibility = "11"
targetCompatibility = "11"
compileJava.options.encoding = "UTF-8"
sourceSets.main.java.srcDirs = ["source"]
sourceSets.main.resources.srcDirs = ["resources"]
sourceSets.test.java.srcDirs = ["test"]

repositories {
    mavenCentral()
}

dependencies {
    compile "com.google.guava:guava:28.2-jre"
    compile "org.jdom:jdom2:2.0.6"
    compile "jaxen:jaxen:1.2.0"
    compile "com.google.code.gson:gson:2.8.6"
    compileOnly "javax.servlet:javax.servlet-api:3.1.0"
    testCompile "junit:junit:4.12"
    testCompile "javax.servlet:javax.servlet-api:3.1.0"
}

task coverage(dependsOn: ["test", "jacocoTestReport"]) {
    doLast {
        def report = file("${buildDir}/reports/jacoco/test/html/index.html").text
        def coverage = report =~ "tfoot.*?ctr2.*?>([\\d.]+%).*?tfoot"
        println "-" * 40
        println "Test coverage: " + coverage[0][1]
    }
}
